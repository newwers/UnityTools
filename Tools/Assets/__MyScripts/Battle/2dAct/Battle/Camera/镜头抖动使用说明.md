# 镜头抖动系统使用说明

## 功能概述

镜头抖动系统通过 Cinemachine 的 `CinemachineImpulseSource` 实现，支持优先级管理，可以在战斗中为攻击、技能等添加镜头震动效果以增强打击感。

## 核心组件

### 1. EffectCategory.CameraShake
在 `EffectCategory` 枚举中新增的镜头抖动类型，用于创建镜头抖动效果。

### 2. CameraShakeManager
单例管理器，负责：
- 管理所有正在执行的镜头抖动
- 根据优先级决定是否执行新的抖动请求
- 自动清理过期的抖动数据

### 3. CameraShakeData
镜头抖动数据类，包含：
- `force`: 抖动力度
- `velocity`: 抖动方向
- `priority`: 优先级
- `startTime`: 开始时间
- `duration`: 持续时间

## 优先级规则

1. **高优先级打断低优先级**：当新请求的优先级高于当前正在执行的抖动时，会立即打断并执行新的抖动
2. **相同优先级后者覆盖前者**：优先级相同时，最后的请求会覆盖之前的请求
3. **低优先级被忽略**：当新请求的优先级低于当前抖动时，请求会被忽略

## 使用方法

### 场景设置

1. 在场景中创建一个空 GameObject，命名为 `CameraShakeManager`
2. 添加 `CameraShakeManager` 组件
3. 添加 `CinemachineImpulseSource` 组件并配置参数：
   - Impulse Channel: 选择合适的频道
   - Impulse Shape: 选择抖动形状（如 Bump）
   - Impulse Duration: 默认抖动持续时间（如 0.2 秒）
   - Default Velocity: 默认抖动方向（如 Vector3.down）

4. 确保场景中的 Cinemachine Camera 添加了 `CinemachineImpulseListener` 扩展

### 创建镜头抖动效果

在 Unity 编辑器中创建镜头抖动效果：

1. 右键点击 Project 窗口
2. 选择 `Create > Character System > Effect > Effect Data`
3. 设置效果属性：
   - **Category**: 选择 `镜头抖动`
   - **Duration**: 抖动持续时间（如 0.2 秒）
   - **Parameters**: 添加以下参数

#### 参数说明

| 参数名 | 类型 | 说明 | 默认值 |
|--------|------|------|--------|
| `force` | float | 抖动力度，通常为 0.1-2.0 | 1.0 |
| `priority` | float | 优先级，数值越大优先级越高 | 0 |
| `velocityX` | float | 自定义抖动方向 X 分量（可选） | 0 |
| `velocityY` | float | 自定义抖动方向 Y 分量（可选） | 0 |
| `velocityZ` | float | 自定义抖动方向 Z 分量（可选） | 0 |

### 示例配置

#### 普通攻击镜头抖动
```
Category: 镜头抖动
Duration: 0.15
Parameters:
  - force: 0.5
  - priority: 1
```

#### 重击镜头抖动
```
Category: 镜头抖动
Duration: 0.3
Parameters:
  - force: 1.5
  - priority: 5
```

#### 技能镜头抖动（自定义方向）
```
Category: 镜头抖动
Duration: 0.25
Parameters:
  - force: 2.0
  - priority: 10
  - velocityX: 0
  - velocityY: -1
  - velocityZ: 0.5
```

## 代码调用

### 方法 1: 通过 BuffSystem 应用（推荐）
将镜头抖动效果添加到技能或攻击的 `EffectData` 中，系统会自动处理。

### 方法 2: 直接调用 CameraShakeManager
```csharp
// 使用默认方向
CameraShakeManager.Instance.TriggerCameraShake(
    force: 1.0f,
    priority: 5f,
    duration: 0.2f
);

// 使用自定义方向
CameraShakeManager.Instance.TriggerCameraShake(
    force: 1.5f,
    velocity: new Vector3(0, -1, 0.5f),
    priority: 10f,
    duration: 0.3f
);
```

## 最佳实践

1. **优先级分配建议**：
   - 普通攻击: 0-5
   - 重击/蓄力攻击: 6-15
   - 小型技能: 16-30
   - 大型技能/终结技: 31-50
   - 特殊事件（Boss 登场等）: 51+

2. **力度建议**：
   - 轻微抖动: 0.1-0.5
   - 中等抖动: 0.6-1.5
   - 强烈抖动: 1.6-3.0

3. **持续时间建议**：
   - 快速打击: 0.05-0.15 秒
   - 普通攻击: 0.15-0.25 秒
   - 重击: 0.25-0.4 秒
   - 大型技能: 0.4-0.6 秒

4. **性能优化**：
   - 避免同时触发过多低优先级的抖动
   - 合理设置持续时间，避免过长的抖动影响体验

## 注意事项

1. 场景中必须有配置了 `CinemachineImpulseListener` 的相机才能看到效果
2. `CameraShakeManager` 必须作为单例存在于场景中
3. 抖动效果使用 `Time.unscaledTime`，不受 `Time.timeScale` 影响
4. 如果不提供自定义方向（velocityX/Y/Z），将使用 `CinemachineImpulseSource` 的默认方向
