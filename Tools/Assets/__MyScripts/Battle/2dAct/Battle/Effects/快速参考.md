# 属性效果系统快速参考

## 效果类型速查表

| 效果类型 | InspectorName | 参数名 | 说明 |
|---------|--------------|--------|------|
| **InstantHeal** | 立即回血 | healAmount | 瞬间回复生命值 |
| **InstantEnergyRestore** | 立即回复能量 | energyAmount | 瞬间回复能量值 |
| **EnergyRegeneration** | 持续回复能量 | energyPerSecond | 每秒回复能量 |
| **StrengthBoost** | 增加力量 | strengthAmount / strengthPercent | 增加力量（固定值或%） |
| **SpeedBoost** | 增加移速 | speedAmount / speedPercent | 增加移速（固定值或%） |
| **AttackBoost** | 增加攻击 | attackAmount / attackPercent | 增加攻击（固定值或%） |
| **DefenseBoost** | 增加防御 | defenseAmount / defensePercent | 增加防御（固定值或%） |
| **CritRateBoost** | 增加暴击率 | critRatePercent | 增加暴击率% |
| **CritDamageBoost** | 增加暴击伤害 | critDamagePercent | 增加暴击伤害% |
| **MaxHealthBoost** | 增加生命上限 | maxHealthAmount / maxHealthPercent | 增加生命上限（固定值或%） |
| **MaxEnergyBoost** | 增加能量上限 | maxEnergyAmount / maxEnergyPercent | 增加能量上限（固定值或%） |

## 常用代码片段

### 1. 立即回血
```csharp
var heal = EffectDataExamples.CreateInstantHealEffect(50f);
buffSystem.ApplyBuff(heal);
```

### 2. 持续回复能量
```csharp
var regen = EffectDataExamples.CreateEnergyRegenerationEffect(10f, 5f);
buffSystem.ApplyBuff(regen);
```

### 3. 增加移速（百分比）
```csharp
var speed = EffectDataExamples.CreateSpeedBoostEffect(15f, speedPercent: 30f);
buffSystem.ApplyBuff(speed);
```

### 4. 增加力量（固定值）
```csharp
var strength = EffectDataExamples.CreateStrengthBoostEffect(30f, strengthAmount: 10f);
buffSystem.ApplyBuff(strength);
```

### 5. 组合Buff
```csharp
buffSystem.ApplyBuff(EffectDataExamples.CreateStrengthBoostEffect(30f, strengthPercent: 20f));
buffSystem.ApplyBuff(EffectDataExamples.CreateSpeedBoostEffect(30f, speedPercent: 30f));
buffSystem.ApplyBuff(EffectDataExamples.CreateAttackBoostEffect(30f, attackPercent: 25f));
```

### 6. 从伤害计算器读取攻击加成
```csharp
float attackBonus = 0f;
float attackPercent = 0f;

foreach (var buff in buffSystem.GetActiveBuffs())
{
    if (buff.data.category == EffectCategory.AttackBoost)
    {
        attackBonus += buff.data.GetParameterValue("attackAmount");
        attackPercent += buff.data.GetParameterValue("attackPercent");
    }
}

float finalDamage = (baseDamage + attackBonus) * (1f + attackPercent / 100f);
```

## 创建自定义效果

### 在代码中创建
```csharp
var effect = ScriptableObject.CreateInstance<EffectData>();
effect.effectName = "自定义效果";
effect.category = EffectCategory.SpeedBoost;
effect.duration = 10f;
effect.canStack = true;
effect.maxStacks = 3;

effect.parameters.Add(new EffectParameter 
{ 
    name = "speedPercent", 
    value = 25f,
    description = "移速增加百分比"
});

buffSystem.ApplyBuff(effect);
```

### 在Editor中创建
1. 右键 > Create > Character System > Effect > Effect Data
2. 设置效果分类（下拉菜单已显示中文）
3. 添加参数到Parameters列表

## 测试工具

### AttributeEffectsTest
```csharp
// 挂载到GameObject
// 设置targetBuffSystem和targetAttributes
// 按数字键1-9和0测试不同效果
```

### SkillWithAttributeEffects
```csharp
// 挂载到GameObject
// 设置playerAttributes和playerBuffSystem
// 按Q/W/E/R/T键测试技能
```

## 效果持续时间

| 效果类型 | 推荐持续时间 |
|---------|-------------|
| 立即效果 | 0秒 |
| 短期Buff | 5-15秒 |
| 中期Buff | 20-40秒 |
| 长期Buff | 60-120秒 |
| 永久Buff | isPermanent = true |

## 堆叠配置

| 效果类型 | canStack | maxStacks | stackBehavior |
|---------|----------|-----------|---------------|
| 治疗类 | false | 1 | RefreshDuration |
| 属性增强 | true | 3-5 | RefreshDuration |
| 持续伤害 | true | 3-5 | IncreaseValue |
| 护盾 | true | 3 | IncreaseValue |

## 常见问题

**Q: 为什么立即回血不生效？**
A: 确保duration设为0，并且healAmount参数名正确。

**Q: 百分比效果如何计算？**
A: 使用乘法：`newValue = oldValue * (1 + percent / 100)`

**Q: 攻击增强为什么没效果？**
A: AttackBoost需要在伤害计算器中手动读取Buff参数。

**Q: 上限增加后当前值会增加吗？**
A: 不会自动增加，需要手动回复或使用立即回复效果。

**Q: 如何检查当前有哪些Buff？**
A: 使用`buffSystem.GetActiveBuffs()`获取所有激活的Buff列表。

## 性能建议

1. 避免每帧创建新的EffectData，使用预制的ScriptableObject
2. 合理设置堆叠上限，避免过多层数
3. 周期性效果（每秒）已优化，不会造成性能问题
4. 使用对象池管理临时创建的效果

## 调试技巧

1. 启用LogManager查看详细日志
2. 在Inspector中观察CharacterAttributes实时变化
3. 使用`Debug.Log(buffSystem.GetActiveBuffs().Count)`查看Buff数量
4. 在BuffSystem中设置断点检查Buff应用流程
